{% extends 'base.html' %}

{% block title %}SatÄ±cÄ± Panelim - Spradar{% endblock %}

{% block content %}
<div class="container my-5">
    <!-- BaÅŸlÄ±k ve Ä°statistikler -->
    <div class="row mb-4">
        <div class="col-md-12">
            <h2><i class="bi bi-briefcase"></i> SatÄ±cÄ± Panelim</h2>
            <p class="text-muted">Kredi satÄ±ÅŸlarÄ±nÄ±zÄ± buradan yÃ¶netin</p>
        </div>
    </div>

    <!-- Ä°statistik KartlarÄ± -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h3 class="text-primary">{{ user.profile.credits }}</h3>
                    <p class="text-muted mb-0">Mevcut Kredilerim</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h3 class="text-warning">{{ pending_orders.count }}</h3>
                    <p class="text-muted mb-0">Bekleyen SipariÅŸ</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h3 class="text-success">{{ user.profile.supervisor_completed_orders }}</h3>
                    <p class="text-muted mb-0">Tamamlanan SipariÅŸ</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h3 class="text-info">{{ success_rate|floatformat:1 }}%</h3>
                    <p class="text-muted mb-0">BaÅŸarÄ± OranÄ±</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Ayarlar Butonu -->
    <div class="row mb-4">
        <div class="col-md-12">
            <a href="{% url 'supervisor_settings' %}" class="btn btn-outline-primary">
                <i class="bi bi-gear"></i> SatÄ±cÄ± AyarlarÄ±m (Fiyat, Banka Bilgileri)
            </a>
            <a href="{% url 'buy_credits' %}" class="btn btn-outline-success">
                <i class="bi bi-cart-plus"></i> Toptan Kredi Al (0.29 â‚º)
            </a>
        </div>
    </div>

    <!-- SipariÅŸler Tabs -->
    <div class="card shadow-sm">
        <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs" id="orderTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button">
                        <i class="bi bi-hourglass-split"></i> Bekleyen ({{ pending_orders.count }})
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved" type="button">
                        <i class="bi bi-check-circle"></i> Onaylanan ({{ approved_orders.count }})
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="rejected-tab" data-bs-toggle="tab" data-bs-target="#rejected" type="button">
                        <i class="bi bi-x-circle"></i> Reddedilen ({{ rejected_orders.count }})
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button">
                        <i class="bi bi-list"></i> TÃ¼m SipariÅŸler ({{ all_orders.count }})
                    </button>
                </li>
            </ul>
        </div>
        <div class="card-body">
            <div class="tab-content" id="orderTabsContent">
                <!-- Bekleyen SipariÅŸler -->
                <div class="tab-pane fade show active" id="pending" role="tabpanel">
                    {% if pending_orders %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Tarih</th>
                                        <th>AlÄ±cÄ±</th>
                                        <th>Miktar</th>
                                        <th>Tutar</th>
                                        <th>Ã–deme Kodu</th>
                                        <th>Ä°ÅŸlemler</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for order in pending_orders %}
                                    <tr>
                                        <td>{{ order.created_at|date:"d.m.Y H:i" }}</td>
                                        <td>
                                            <strong>{{ order.buyer.user.username }}</strong><br>
                                            <small class="text-muted">{{ order.buyer.user.email }}</small>
                                        </td>
                                        <td><span class="badge bg-info">{{ order.credit_amount }} kredi</span></td>
                                        <td><strong>{{ order.total_price }} â‚º</strong></td>
                                        <td><code>{{ order.payment_code }}</code></td>
                                        <td>
                                            <form method="POST" action="{% url 'supervisor_approve_order' order.id %}" style="display: inline;">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-sm btn-success" onclick="return confirm('Bu sipariÅŸi onaylamak istediÄŸinizden emin misiniz?')">
                                                    <i class="bi bi-check"></i> Onayla
                                                </button>
                                            </form>
                                            <form method="POST" action="{% url 'supervisor_reject_order' order.id %}" style="display: inline;">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Bu sipariÅŸi reddetmek istediÄŸinizden emin misiniz?')">
                                                    <i class="bi bi-x"></i> Reddet
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> Bekleyen sipariÅŸ bulunmuyor.
                        </div>
                    {% endif %}
                </div>

                <!-- Onaylanan SipariÅŸler -->
                <div class="tab-pane fade" id="approved" role="tabpanel">
                    {% if approved_orders %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Tarih</th>
                                        <th>AlÄ±cÄ±</th>
                                        <th>Miktar</th>
                                        <th>Tutar</th>
                                        <th>Ã–deme Kodu</th>
                                        <th>Onay Tarihi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for order in approved_orders %}
                                    <tr>
                                        <td>{{ order.created_at|date:"d.m.Y H:i" }}</td>
                                        <td>
                                            <strong>{{ order.buyer.user.username }}</strong><br>
                                            <small class="text-muted">{{ order.buyer.user.email }}</small>
                                        </td>
                                        <td><span class="badge bg-info">{{ order.credit_amount }} kredi</span></td>
                                        <td><strong>{{ order.total_price }} â‚º</strong></td>
                                        <td><code>{{ order.payment_code }}</code></td>
                                        <td>
                                            <small class="text-success">
                                                <i class="bi bi-check-circle"></i> {{ order.completed_at|date:"d.m.Y H:i" }}
                                            </small>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> Onaylanan sipariÅŸ bulunmuyor.
                        </div>
                    {% endif %}
                </div>

                <!-- Reddedilen SipariÅŸler -->
                <div class="tab-pane fade" id="rejected" role="tabpanel">
                    {% if rejected_orders %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Tarih</th>
                                        <th>AlÄ±cÄ±</th>
                                        <th>Miktar</th>
                                        <th>Tutar</th>
                                        <th>Ã–deme Kodu</th>
                                        <th>Red Nedeni</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for order in rejected_orders %}
                                    <tr>
                                        <td>{{ order.created_at|date:"d.m.Y H:i" }}</td>
                                        <td>
                                            <strong>{{ order.buyer.user.username }}</strong><br>
                                            <small class="text-muted">{{ order.buyer.user.email }}</small>
                                        </td>
                                        <td><span class="badge bg-info">{{ order.credit_amount }} kredi</span></td>
                                        <td><strong>{{ order.total_price }} â‚º</strong></td>
                                        <td><code>{{ order.payment_code }}</code></td>
                                        <td>
                                            <small class="text-danger">
                                                {{ order.rejection_reason|default:"Belirtilmedi" }}
                                            </small>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> Reddedilen sipariÅŸ bulunmuyor.
                        </div>
                    {% endif %}
                </div>

                <!-- TÃ¼m SipariÅŸler -->
                <div class="tab-pane fade" id="all" role="tabpanel">
                    {% if all_orders %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Tarih</th>
                                        <th>AlÄ±cÄ±</th>
                                        <th>Miktar</th>
                                        <th>Tutar</th>
                                        <th>Ã–deme Kodu</th>
                                        <th>Durum</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for order in all_orders %}
                                    <tr>
                                        <td>{{ order.created_at|date:"d.m.Y H:i" }}</td>
                                        <td>
                                            <strong>{{ order.buyer.user.username }}</strong><br>
                                            <small class="text-muted">{{ order.buyer.user.email }}</small>
                                        </td>
                                        <td><span class="badge bg-info">{{ order.credit_amount }} kredi</span></td>
                                        <td><strong>{{ order.total_price }} â‚º</strong></td>
                                        <td><code>{{ order.payment_code }}</code></td>
                                        <td>
                                            {% if order.payment_status == 'PENDING' %}
                                                <span class="badge bg-warning text-dark">â³ Bekliyor</span>
                                            {% elif order.payment_status == 'APPROVED' %}
                                                <span class="badge bg-success">âœ… OnaylandÄ±</span>
                                            {% elif order.payment_status == 'REJECTED' %}
                                                <span class="badge bg-danger">âŒ Reddedildi</span>
                                            {% elif order.payment_status == 'CANCELLED' %}
                                                <span class="badge bg-secondary">ğŸš« Ä°ptal</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> HenÃ¼z sipariÅŸ bulunmuyor.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- YardÄ±m KartÄ± -->
    <div class="card mt-4 shadow-sm">
        <div class="card-body">
            <h6><i class="bi bi-lightbulb"></i> SatÄ±cÄ± Ä°puÃ§larÄ±</h6>
            <ul class="mb-0">
                <li>SipariÅŸleri hÄ±zlÄ±ca onaylayarak baÅŸarÄ± oranÄ±nÄ±zÄ± artÄ±rÄ±n</li>
                <li>Banka hesabÄ±nÄ±zÄ± dÃ¼zenli kontrol edin ve Ã¶demeleri hÄ±zlÄ±ca doÄŸrulayÄ±n</li>
                <li>Yeterli kredi stoÄŸu bulundurun (Toptan Kredi Al butonundan)</li>
                <li>FiyatÄ±nÄ±zÄ± rekabetÃ§i tutarak daha fazla sipariÅŸ alabilirsiniz</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}
